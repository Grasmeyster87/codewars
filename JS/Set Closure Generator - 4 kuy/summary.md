–û—Ç–ª–∏—á–Ω–æ, —á—Ç–æ —Ç–µ–ø–µ—Ä—å –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! –ù–∏–∂–µ ‚Äî **–ø–æ–¥—Ä–æ–±–Ω–æ–µ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ** —Ç–æ–≥–æ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ **–∑–∞–º—ã–∫–∞–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–æ —É–º–Ω–æ–∂–µ–Ω–∏—é**.

---

## üî¢ –ò—Å—Ö–æ–¥–Ω–∞—è –∑–∞–¥–∞—á–∞

–î–∞–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ `S` –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª ‚Üí –Ω—É–∂–Ω–æ **–ø–æ—Å—Ç—Ä–æ–∏—Ç—å –≤—Å–µ —á–∏—Å–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–º–Ω–æ–∂–µ–Ω–∏–µ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ `S` –∏ –º–µ–∂–¥—É —Å–æ–±–æ–π**, –ø—Ä–∏ —ç—Ç–æ–º **–≤ –ø–æ—Ä—è–¥–∫–µ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—è** –∏ **–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π**.

---

## üìú –ö–æ–¥ —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º

```js
function* closureGen(S) {
  if (S.length === 0) return;
```

üîπ –ï—Å–ª–∏ –≤—Ö–æ–¥–Ω–æ–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—É—Å—Ç–æ–µ ‚Äî —Å—Ä–∞–∑—É –≤—ã—Ö–æ–¥–∏–º. –ó–∞–º—ã–∫–∞–Ω–∏–µ –ø—É—Å—Ç–æ.

---

```js
  const base = Array.from(new Set(S.map(BigInt))).sort((a, b) => (a < b ? -1 : 1));
```

üîπ –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º `S` –≤:

* `BigInt` (—Ç.–∫. —á–∏—Å–ª–∞ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–µ),
* `Set` (—É–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã),
* —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é ‚Üí `base` –±—É–¥–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–º –º–∞—Å—Å–∏–≤–æ–º —á–∏—Å–µ–ª, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ–º —Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.

---

```js
  const seen = new Set();
  const heap = [];
```

üîπ `seen` ‚Äî –º–Ω–æ–∂–µ—Å—Ç–≤–æ —á–∏—Å–µ–ª, –∫–æ—Ç–æ—Ä—ã–µ **—É–∂–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã**, —á—Ç–æ–±—ã **–Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã**.

üîπ `heap` ‚Äî —ç—Ç–æ **–º–∏–Ω-–∫—É—á–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å)**, –æ—Ç–∫—É–¥–∞ –º—ã –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç–∞—ë–º **–Ω–∞–∏–º–µ–Ω—å—à–µ–µ –µ—â—ë –Ω–µ –≤—ã–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ**.

---

```js
  const add = x => {
    const key = x.toString();
    if (!seen.has(key)) {
      seen.add(key);
      heapPush(heap, x);
    }
  };
```

üîπ –§—É–Ω–∫—Ü–∏—è `add`:

* –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –±—ã–ª–æ –ª–∏ —á–∏—Å–ª–æ —É–∂–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ (`seen` –ø–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–º—É –∫–ª—é—á—É, —Ç–∞–∫ –∫–∞–∫ `BigInt` –ø–ª–æ—Ö–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ `Set` –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é).
* –ï—Å–ª–∏ —á–∏—Å–ª–æ **–Ω–æ–≤–æ–µ** ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ `seen` –∏ –≤ `heap`.

---

```js
  for (const x of base) {
    add(x);
  }
```

üîπ –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ `S` (—Ç.–µ. `base`) –≤ –∫—É—á—É, –∫–∞–∫ –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

---

```js
  const output = [];

  while (heap.length > 0) {
    const curr = heapPop(heap);
    yield curr;
    output.push(curr);
```

üîπ –ü–æ–∫–∞ –∫—É—á–∞ –Ω–µ –ø—É—Å—Ç–∞:

* –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∏–º–µ–Ω—å—à–µ–µ —á–∏—Å–ª–æ `curr` –∏–∑ –∫—É—á–∏.
* `yield curr` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ –∏–∑ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞.
* –î–æ–±–∞–≤–ª—è–µ–º –≤ `output` (–∏—Å—Ç–æ—Ä–∏—è —É–∂–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∏—Å–µ–ª, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π).

---

```js
    for (const x of base) {
      const prod = curr * x;
      if (!seen.has(prod.toString())) {
        add(prod);
      }
    }
  }
}
```

üîπ –î–ª—è –∫–∞–∂–¥–æ–≥–æ `x` –∏–∑ `base`, –ø–µ—Ä–µ–º–Ω–æ–∂–∞–µ–º –µ–≥–æ —Å —Ç–µ–∫—É—â–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º `curr` ‚Üí `prod = curr * x`.

üîπ –ï—Å–ª–∏ —Ç–∞–∫–æ–µ —á–∏—Å–ª–æ **–µ—â—ë –Ω–µ –≤—Å—Ç—Ä–µ—á–∞–ª–æ—Å—å**, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –∫—É—á—É —á–µ—Ä–µ–∑ `add(prod)`.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:

* `curr` –ø–µ—Ä–µ–º–Ω–æ–∂–∞–µ—Ç—Å—è —Å **–≤—Å–µ–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –∏–∑ `base`**, —á—Ç–æ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –Ω–æ–≤—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.
* –ü–æ—Ä—è–¥–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è —Ç–µ–º, —á—Ç–æ `heap` –≤—Å–µ–≥–¥–∞ –æ—Ç–¥–∞—ë—Ç **–Ω–∞–∏–º–µ–Ω—å—à–µ–µ** —á–∏—Å–ª–æ.

---

## üìå –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Min-Heap (`heapPush`, `heapPop`)

–≠—Ç–æ –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –º–∞—Å—Å–∏–≤–µ:

```js
function heapPush(heap, value) {
  heap.push(value);                    // –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü
  let i = heap.length - 1;
  while (i > 0) {                      // "–≤—Å–ø–ª—ã—Ç–∏–µ"
    const parent = Math.floor((i - 1) / 2);
    if (heap[parent] <= heap[i]) break;
    [heap[parent], heap[i]] = [heap[i], heap[parent]];
    i = parent;
  }
}
```

üîπ –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —á–∏—Å–ª–∞ ‚Äî **–≤—Å–ø–ª—ã–≤–∞–µ–º** –≤–≤–µ—Ä—Ö –ø–æ –∫—É—á–µ, –ø–æ–∫–∞ –Ω–µ –æ–∫–∞–∂–µ–º—Å—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ.

```js
function heapPop(heap) {
  const result = heap[0];             // –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
  const last = heap.pop();            // –∑–∞–º–µ–Ω—è–µ–º –∫–æ—Ä–µ–Ω—å –ø–æ—Å–ª–µ–¥–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º
  if (heap.length === 0) return result;
  heap[0] = last;
  let i = 0;
  while (true) {                      // "–ø—Ä–æ—Å–µ–∏–≤–∞–Ω–∏–µ" –≤–Ω–∏–∑
    const left = 2 * i + 1;
    const right = 2 * i + 2;
    let smallest = i;
    if (left < heap.length && heap[left] < heap[smallest]) smallest = left;
    if (right < heap.length && heap[right] < heap[smallest]) smallest = right;
    if (smallest === i) break;
    [heap[i], heap[smallest]] = [heap[smallest], heap[i]];
    i = smallest;
  }
  return result;
}
```

üîπ –£–¥–∞–ª—è–µ–º –∫–æ—Ä–µ–Ω—å, –∑–∞–º–µ–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –∏ **–æ–ø—É—Å–∫–∞–µ–º** –µ–≥–æ –≤–Ω–∏–∑, –ø–æ–∫–∞ –æ–Ω –Ω–µ –≤—Å—Ç–∞–Ω–µ—Ç –Ω–∞ —Å–≤–æ—ë –º–µ—Å—Ç–æ.

---

## ‚úÖ –í—ã–≤–æ–¥

–ê–ª–≥–æ—Ä–∏—Ç–º:

* –í—Å–µ–≥–¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç **–Ω–∞–∏–º–µ–Ω—å—à–µ–µ –Ω–æ–≤–æ–µ —á–∏—Å–ª–æ**, –∏—Å–ø–æ–ª—å–∑—É—è –∫—É—á—É.
* –ò–∑–±–µ–≥–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ `seen`.
* –†–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –∏ –≤ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –±–ª–∞–≥–æ–¥–∞—Ä—è min-heap.
* –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ–º–Ω–æ–∂–µ–Ω–∏—è (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –Ω–∞–∏–≤–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–ª `current * –≤—Å—ë` –∫–∞–∂–¥—ã–π —Ä–∞–∑).

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É –µ—â—ë –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ.
